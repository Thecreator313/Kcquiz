<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Participant Report</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f4f9;
    }

    .container {
      max-width: 600px;
      margin: 20px auto;
      padding: 10px;
    }

    .card {
      display: flex;
      align-items: center;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      margin-bottom: 15px;
      padding: 10px;
    }

    .card img {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      margin-right: 15px;
    }

    .details {
      flex-grow: 1;
    }

    .details h3 {
      margin: 0;
      font-size: 18px;
      color: #333;
    }

    .details p {
      margin: 2px 0 0;
      color: #777;
      font-size: 14px;
    }

    .total-marks {
      font-size: 20px;
      font-weight: bold;
      color: #007bff;
    }

    .fab {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 60px;
      height: 60px;
      background: #007bff;
      color: white;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      cursor: pointer;
      font-size: 24px;
    }

    .fab:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Participant Report</h1>
    <div id="participant-list"></div>
  </div>

  <div class="fab" onclick="downloadPDF()">
    <i class="fas fa-download"></i>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD2KL9rylqxERm8HvCQywMlsAj0GF4CEGU",
      authDomain: "quiz-3e9de.firebaseapp.com",
      databaseURL: "https://quiz-3e9de-default-rtdb.firebaseio.com",
      projectId: "quiz-3e9de",
      storageBucket: "quiz-3e9de.appspot.com",
      messagingSenderId: "203388736003",
      appId: "1:203388736003:web:f10a9c5fe0527450e07436",
      measurementId: "G-RKWX4YMKVD"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const participantList = document.getElementById("participant-list");

    function calculateTotalMarks(marks) {
      return Object.values(marks || {}).reduce((total, mark) => total + (mark.value || 0), 0);
    }

    function loadParticipants() {
      const participantsRef = ref(db, "participants");
      onValue(participantsRef, (snapshot) => {
        participantList.innerHTML = "";
        const participants = snapshot.val();

        if (participants) {
          Object.entries(participants)
            .sort(([, a], [, b]) => calculateTotalMarks(b.marks) - calculateTotalMarks(a.marks))
            .forEach(([id, participant]) => {
              const totalMarks = calculateTotalMarks(participant.marks);
              const card = document.createElement("div");
              card.className = "card";
              card.innerHTML = `
                <img src="https://i.ibb.co/d72xswc/image.png" alt="Participant">
                <div class="details">
                  <h3>${participant.name}</h3>

                </div>
                <div class="total-marks">${totalMarks}</div>
              `;
              participantList.appendChild(card);
            });
        }
      });
    }

    loadParticipants();

    window.downloadPDF = function downloadPDF() {
  const { jsPDF } = window.jspdf; // Correctly access jsPDF
  const doc = new jsPDF(); // Create the PDF document

  // Add title with large font and centered alignment
  doc.setFontSize(24);
  doc.setFont("helvetica", "bold");
  doc.text('Participant Report', 105, 20, { align: 'center' });

  // Set up the table header with a blue background and white text
  doc.setFontSize(12);
  doc.setFont("helvetica", "bold");
  doc.setTextColor(255, 255, 255);
  doc.setFillColor(0, 123, 255); // Blue color for header
  doc.rect(10, 30, 190, 10, 'F'); // Table header background
  doc.text('Name', 15, 35);
  doc.text('Total Marks', 140, 35);

  // Add space between header and first row
  let y = 45; // Increase Y position to add space after the header

  // Reset font color and set the regular font for table rows
  doc.setFont("helvetica", "normal");
  doc.setTextColor(0, 0, 0); // Black text

  // Define alternating row colors for better readability
  let rowColor = [245, 245, 245]; // Light gray color for odd rows

  const cards = document.querySelectorAll(".card");

  cards.forEach((card, index) => {
    const name = card.querySelector(".details h3").textContent;
    const marks = card.querySelector(".total-marks").textContent;

    // Draw the row background with alternating colors
    doc.setFillColor(...rowColor);
    doc.rect(10, y - 4, 190, 10, 'F'); // Draw background for the row

    // Add participant details to the row
    doc.text(name, 15, y);
    doc.text(phone, 75, y);
    doc.text(marks, 140, y);

    // Alternate row colors
    rowColor = rowColor[0] === 245 ? [255, 255, 255] : [245, 245, 245]; // Switch between light gray and white

    y += 10;
    if (y > 270) {
      doc.addPage(); // Add a new page if the content exceeds the current pageâ€™s space
      y = 10;
    }
  });

  // Add a footer with the current date and page number
  const pageCount = doc.internal.getNumberOfPages();
  for (let i = 1; i <= pageCount; i++) {
    doc.setPage(i);
    doc.setFontSize(10);
    doc.setFont("helvetica", "normal");
    doc.setTextColor(100, 100, 100); // Gray color for footer text
    doc.text(`Page ${i} of ${pageCount}`, 180, 290);
    doc.text(`Date: ${new Date().toLocaleDateString()}`, 10, 290); // Current date in footer
  }

  // Save the document
  doc.save("participants.pdf");
};




  </script>
</body>
</html>
